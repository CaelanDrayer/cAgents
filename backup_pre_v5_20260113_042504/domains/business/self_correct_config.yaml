# Business Domain Self-Correct Configuration
# Adaptive recovery strategies for business deliverable issues

domain: business
version: 1.0
description: "Self-correction strategies for business operations, strategy, and analysis deliverables"

# Correction Strategies
# How to fix common business deliverable issues

correction_strategies:
  missing_executive_summary:
    description: "Deliverable missing required executive summary"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "15-20 minutes"
    max_retries: 2
    steps:
      - "Read full deliverable to understand key points"
      - "Extract 3-5 main findings or recommendations"
      - "Write 1-2 page executive summary highlighting key points"
      - "Place at beginning of document"
      - "Ensure summary is accessible to non-technical executives"
    acceptance_criteria:
      - "Executive summary 500-2000 words"
      - "Covers main findings and recommendations"
      - "No jargon or unexplained technical terms"
      - "Positioned at document start"

  missing_data_sources:
    description: "Data points without source citations"
    fixable: true
    agent_to_invoke: "market-analyst"
    estimated_time: "20-30 minutes"
    max_retries: 2
    steps:
      - "Identify all data points in deliverable"
      - "For each uncited data point, find credible source"
      - "Add citations using consistent format (footnotes or bibliography)"
      - "Verify source credibility and recency"
      - "Add sources section if not present"
    acceptance_criteria:
      - "Every data point has source attribution"
      - "Sources are credible (reputable publications, databases, research firms)"
      - "Sources are recent (< 6 months for market data)"
      - "Citation format consistent throughout"
    fallback_if_unfixable:
      reason: "Cannot find credible source for data point"
      escalation: "HITL - request stakeholder input on acceptable data sources"

  assumptions_not_documented:
    description: "Key assumptions implicit rather than explicit"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "15-25 minutes"
    max_retries: 2
    steps:
      - "Review deliverable for all forecasts, projections, or recommendations"
      - "Identify underlying assumptions (growth rates, market conditions, etc.)"
      - "Create dedicated Assumptions section"
      - "List each assumption with rationale"
      - "Highlight critical assumptions vs. supporting assumptions"
    acceptance_criteria:
      - "Dedicated Assumptions section present"
      - "All key assumptions explicitly stated"
      - "Each assumption has brief justification"
      - "Assumptions grouped logically (market, financial, operational)"

  formatting_issues:
    description: "Typos, inconsistent formatting, or template non-compliance"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "10-20 minutes"
    max_retries: 1
    steps:
      - "Run spell-check on all text"
      - "Fix typos and grammatical errors"
      - "Apply corporate template if not already used"
      - "Ensure consistent heading hierarchy"
      - "Verify consistent font, spacing, style"
      - "Check professional tone throughout"
    acceptance_criteria:
      - "No spelling errors"
      - "Corporate template applied"
      - "Consistent formatting throughout"
      - "Professional tone maintained"

  missing_visual_aids:
    description: "Charts, graphs, or tables missing or inadequate"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "20-30 minutes"
    max_retries: 2
    steps:
      - "Identify data that would benefit from visualization"
      - "Create appropriate charts (bar, line, pie, matrix as appropriate)"
      - "Ensure all visuals properly labeled (title, axes, legend)"
      - "Add captions or explanatory text"
      - "Verify visual quality (professional, clear, not cluttered)"
    acceptance_criteria:
      - "Key data visualized appropriately"
      - "All charts have titles and labels"
      - "Visual style consistent with corporate standards"
      - "Visuals enhance understanding, not just decoration"

  calculations_incorrect:
    description: "Financial calculations or formulas contain errors"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "20-40 minutes"
    max_retries: 2
    steps:
      - "Review all formulas and calculations"
      - "Verify mathematical correctness"
      - "Check for circular references"
      - "Ensure totals reconcile"
      - "Validate against source data"
      - "Test with sample scenarios"
    acceptance_criteria:
      - "All formulas mathematically correct"
      - "No circular references"
      - "Totals and subtotals reconcile"
      - "Calculations verified against known correct values"
    fallback_if_unfixable:
      reason: "Fundamental methodology issue in calculations"
      escalation: "HITL - require expert review of approach"

  incomplete_analysis:
    description: "Analysis sections missing required components"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "30-60 minutes"
    max_retries: 2
    steps:
      - "Identify missing analysis components per validation rules"
      - "For each missing component, gather necessary information"
      - "Perform required analysis (trend analysis, gap analysis, etc.)"
      - "Write analysis section with findings"
      - "Ensure analysis supports recommendations"
    acceptance_criteria:
      - "All required analysis sections present"
      - "Analysis depth appropriate for tier"
      - "Findings clearly stated"
      - "Analysis logically supports recommendations"

  recommendations_unsupported:
    description: "Recommendations lack supporting analysis or data"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "20-30 minutes"
    max_retries: 2
    steps:
      - "Review each recommendation"
      - "Identify supporting analysis or data in deliverable"
      - "If support missing, either:"
      - "  a) Add analysis to support recommendation, OR"
      - "  b) Remove/revise unsupported recommendation"
      - "Create explicit link between analysis and recommendation"
    acceptance_criteria:
      - "Every recommendation has clear supporting analysis"
      - "Link between analysis and recommendation is explicit"
      - "No recommendations appear arbitrary or unsupported"

  missing_implementation_plan:
    description: "Strategic plan or process design lacks implementation roadmap"
    fixable: true
    agent_to_invoke: "project-manager"
    estimated_time: "30-45 minutes"
    max_retries: 2
    steps:
      - "Review recommendations and proposed changes"
      - "Break down into implementation phases"
      - "Define timeline with milestones"
      - "Identify resources required"
      - "Assign responsibilities (or identify who should own)"
      - "Create implementation roadmap with Gantt chart or timeline visual"
    acceptance_criteria:
      - "Implementation plan section present"
      - "Timeline with milestones defined"
      - "Resource requirements identified"
      - "Responsibilities assigned or identified"
      - "Visual roadmap included"

  missing_risk_assessment:
    description: "Strategic plan missing risk analysis"
    fixable: true
    agent_to_invoke: "risk-manager"
    estimated_time: "30-45 minutes"
    max_retries: 2
    steps:
      - "Review strategic plan for inherent risks"
      - "Identify 5-10 key risks"
      - "Assess likelihood and impact for each"
      - "Create risk matrix (visual)"
      - "Define mitigation strategies for high-priority risks"
      - "Add Risk Assessment section to plan"
    acceptance_criteria:
      - "Risk Assessment section present"
      - "5-10 key risks identified"
      - "Risk matrix visual included"
      - "Mitigation strategies for high risks"

  tone_inappropriate:
    description: "Tone too casual or technical for intended audience"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "20-30 minutes"
    max_retries: 2
    steps:
      - "Review entire document for tone"
      - "Identify overly casual language and make more professional"
      - "Identify jargon or technical terms and either remove or explain"
      - "Ensure tone appropriate for audience (board, executives, managers)"
      - "Maintain consistency throughout"
    acceptance_criteria:
      - "Professional tone throughout"
      - "Technical terms explained or removed"
      - "Appropriate for intended audience"
      - "Consistent tone from start to finish"

  length_inappropriate:
    description: "Deliverable too brief or excessively long"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "20-40 minutes"
    max_retries: 2
    steps:
      - "If too brief: Expand analysis, add supporting details, add examples"
      - "If too long: Remove redundancy, tighten prose, move detail to appendix"
      - "Ensure all essential content retained"
      - "Verify length now within acceptable range"
    acceptance_criteria:
      - "Length appropriate for deliverable type"
      - "All essential content present"
      - "No unnecessary repetition or verbosity"
    target_lengths:
      executive_summary: "1-2 pages (500-2000 words)"
      market_analysis: "10-20 pages"
      strategic_plan: "15-30 pages"
      forecast: "5-10 pages"

  missing_scenarios:
    description: "Forecast missing multiple scenarios (optimistic, realistic, pessimistic)"
    fixable: true
    agent_to_invoke: "business-analyst"
    estimated_time: "40-60 minutes"
    max_retries: 2
    steps:
      - "Identify baseline forecast (usually realistic scenario)"
      - "Define optimistic scenario (better conditions, higher growth)"
      - "Define pessimistic scenario (worse conditions, lower growth)"
      - "Document key assumption differences between scenarios"
      - "Create comparison table or chart showing all scenarios"
      - "Add scenario analysis section"
    acceptance_criteria:
      - "Minimum 3 scenarios present (optimistic, realistic, pessimistic)"
      - "Assumptions for each scenario documented"
      - "Comparison visual included"
      - "Scenario analysis explains differences"

  stakeholder_input_missing:
    description: "Required stakeholder input not collected"
    fixable: false
    escalation: "HITL - coordinate stakeholder input collection"
    blocking_reason: "Cannot proceed without stakeholder input"
    steps:
      - "Identify which stakeholders need to provide input"
      - "Document what input is needed from each"
      - "Escalate to HITL to coordinate stakeholder meetings/input"
      - "Wait for HITL to collect and provide stakeholder input"
      - "Once input received, incorporate into deliverable"

  conflicting_requirements:
    description: "Stakeholders have conflicting requirements or priorities"
    fixable: false
    escalation: "HITL - facilitate stakeholder conflict resolution"
    blocking_reason: "Cannot resolve strategic conflicts autonomously"
    steps:
      - "Document all conflicting requirements clearly"
      - "Identify which stakeholders hold each position"
      - "Present conflict to HITL with context"
      - "Wait for HITL to facilitate resolution"
      - "Implement agreed-upon resolution"

  data_source_unavailable:
    description: "Required data source is inaccessible or doesn't exist"
    fixable: false
    escalation: "HITL - identify alternative data sources or adjust scope"
    blocking_reason: "Cannot complete analysis without required data"
    steps:
      - "Document which data is unavailable and why"
      - "Identify potential alternative data sources"
      - "Present options to HITL"
      - "Wait for HITL decision on approach"

  fundamental_methodology_issue:
    description: "Approach or methodology is fundamentally flawed"
    fixable: false
    escalation: "HITL - require expert review and new approach"
    blocking_reason: "Surface fixes won't solve deep methodology problems"
    steps:
      - "Document the methodology issue clearly"
      - "Explain why current approach is inadequate"
      - "Present to HITL for expert review"
      - "Wait for guidance on correct methodology"
      - "Restart analysis with corrected approach"

# Fixability Criteria
# How to determine if an issue can be self-corrected

fixability_criteria:
  FIXABLE:
    conditions:
      - type: "missing_content"
        fixable: true
        examples: ["missing executive summary", "missing assumptions", "missing visuals"]
        reason: "Agent can add missing sections by analyzing existing content"

      - type: "formatting_quality"
        fixable: true
        examples: ["typos", "formatting inconsistency", "template non-compliance"]
        reason: "Mechanical fixes that don't require new information"

      - type: "citations_missing"
        fixable: true
        examples: ["data without sources", "uncited statistics"]
        reason: "Agent can research and add appropriate citations"
        caveat: "Only if credible sources exist for the data points"

      - type: "calculations_incorrect"
        fixable: true
        examples: ["formula errors", "math mistakes", "totals don't reconcile"]
        reason: "Agent can verify and correct mathematical errors"
        caveat: "Only if methodology is sound; fundamental approach issues require HITL"

      - type: "incomplete_analysis"
        fixable: true
        examples: ["missing analysis sections", "shallow analysis", "unsupported recommendations"]
        reason: "Agent can deepen analysis using existing data"
        caveat: "Only if required data is available; missing data requires HITL"

  NOT_FIXABLE:
    conditions:
      - type: "stakeholder_approval"
        fixable: false
        examples: ["department head approval missing", "C-level sign-off needed"]
        reason: "Requires human decision-making authority"
        escalation: "HITL coordinates approval process"

      - type: "stakeholder_conflict"
        fixable: false
        examples: ["conflicting requirements", "competing priorities", "disagreement on direction"]
        reason: "Requires human judgment and negotiation"
        escalation: "HITL facilitates conflict resolution"

      - type: "data_unavailable"
        fixable: false
        examples: ["required data doesn't exist", "data source inaccessible", "proprietary data needed"]
        reason: "Agent cannot create or access data it doesn't have"
        escalation: "HITL identifies alternatives or adjusts scope"

      - type: "fundamental_flaw"
        fixable: false
        examples: ["methodology incorrect", "flawed assumptions challenged", "approach inappropriate"]
        reason: "Surface fixes won't solve deep structural problems"
        escalation: "HITL provides expert guidance and new approach"

# Retry Limits
# How many times to attempt self-correction before escalating

retry_limits:
  global_max_retries: 3
  per_issue_max_retries: 2

  tier_specific:
    tier_1: 2  # Simple tasks, retry twice max
    tier_2: 3  # Moderate tasks, retry three times max
    tier_3: 3  # Complex tasks, retry three times max
    tier_4: 2  # Expert tasks, fewer retries before HITL

  issue_specific:
    formatting_issues: 1  # Should fix on first try
    missing_content: 2  # May need iteration
    calculations_incorrect: 2  # Should fix in 1-2 attempts
    tone_inappropriate: 2  # May need iteration
    data_quality: 3  # Can be tricky, allow more attempts

  escalation_thresholds:
    same_issue_recurring: "If same issue fails twice, escalate to HITL"
    multiple_issues_per_attempt: "If 5+ issues per attempt, escalate (indicates deeper problem)"
    no_progress_after_retry: "If retry doesn't improve score, escalate"

# Self-Correction Workflow

self_correction_workflow:
  steps:
    - step: 1
      name: "Load validation report"
      action: "Read validation_report.yaml to understand all issues"

    - step: 2
      name: "Check retry count"
      action: "Verify retry count < max_retries, else escalate to HITL"

    - step: 3
      name: "Classify issues by fixability"
      action: "Separate FIXABLE issues from BLOCKED issues"

    - step: 4
      name: "Prioritize fixes"
      action: "Fix critical issues first, then major, then minor"

    - step: 5
      name: "Execute fixes"
      action: "Invoke appropriate agent for each fixable issue using Task tool"

    - step: 6
      name: "Update deliverable"
      action: "Agent makes corrections to outputs in Agent_Memory"

    - step: 7
      name: "Re-validate"
      action: "Invoke universal-validator using Task tool to check if issues resolved"

    - step: 8
      name: "Check progress"
      action: "Compare new validation report to previous - did issues decrease?"

    - step: 9
      name: "Decide next action"
      action: |
        If PASS: Mark complete
        If FIXABLE with retries remaining: Retry (go to step 1)
        If BLOCKED or max retries reached: Escalate to HITL

# Learning from Corrections
# Track which strategies work best

learning_tracking:
  strategy_effectiveness:
    missing_executive_summary:
      total_attempts: 0
      successful_fixes: 0
      success_rate: 0.0
      avg_fix_time_minutes: 0

    missing_data_sources:
      total_attempts: 0
      successful_fixes: 0
      success_rate: 0.0
      avg_fix_time_minutes: 0

    assumptions_not_documented:
      total_attempts: 0
      successful_fixes: 0
      success_rate: 0.0
      avg_fix_time_minutes: 0

    formatting_issues:
      total_attempts: 0
      successful_fixes: 0
      success_rate: 0.0
      avg_fix_time_minutes: 0

  common_patterns:
    - pattern: "Missing data sources frequently fixed on first retry"
      observation: "market-analyst effective at adding citations"

    - pattern: "Formatting issues almost always fixed on first try"
      observation: "business-analyst reliable for polish"

    - pattern: "Incomplete analysis sometimes requires 2 retries"
      observation: "May need deeper dive or additional research"

  escalation_patterns:
    - pattern: "Stakeholder approval issues always escalate"
      observation: "Correctly routed to HITL, no false attempts to self-fix"

    - pattern: "Data unavailability escalates after checking alternatives"
      observation: "market-analyst checks for alternatives before escalating"

# Domain-Specific Self-Correction Notes

self_correction_notes: |
  Business domain self-correction considerations:

  **Most Common Fixable Issues**:
  1. Missing data sources / citations (FIXABLE - market-analyst adds)
  2. Assumptions not documented (FIXABLE - business-analyst documents)
  3. Formatting and typos (FIXABLE - business-analyst polishes)
  4. Missing executive summary (FIXABLE - business-analyst creates)
  5. Incomplete analysis sections (FIXABLE - business-analyst expands)
  6. Missing visuals (FIXABLE - business-analyst adds charts)

  **Most Common Blocking Issues**:
  1. Stakeholder approval required (BLOCKED - requires HITL)
  2. Conflicting stakeholder requirements (BLOCKED - requires HITL mediation)
  3. Critical data source unavailable (BLOCKED - requires alternative approach)
  4. Fundamental methodology challenged (BLOCKED - requires expert review)

  **Agent Assignment for Fixes**:
  - business-analyst: Content, formatting, analysis, documentation
  - market-analyst: Data sourcing, citations, market research
  - project-manager: Implementation plans, timelines, resource planning
  - risk-manager: Risk assessments, mitigation strategies
  - cso: Strategic direction (only if tier 4 and critical issue)

  **Retry Strategy**:
  - First retry: Focus on most critical issues first
  - Second retry: Address all remaining issues comprehensively
  - Third retry: If still failing, likely need HITL intervention
  - Escalate before third retry if no progress observed

  **Progress Indicators**:
  - Issue count decreasing = progress
  - Validation score improving = progress
  - Same issues recurring = likely need HITL
  - New issues appearing = may indicate deeper problem

  **Quality vs Speed Tradeoff**:
  - Business work values quality over speed
  - Better to take time to fix properly than rush
  - Multiple iterations acceptable if making progress
  - Don't hesitate to escalate if stuck

  **Stakeholder Sensitivity**:
  - Some fixes require stakeholder input (not truly self-correctable)
  - Escalate early if stakeholder decision needed
  - Don't make assumptions about stakeholder preferences
  - When in doubt, ask (via HITL)

  **Common Self-Correction Mistakes to Avoid**:
  - Attempting to fix stakeholder conflicts autonomously (always escalate)
  - Adding data without credible sources (better to escalate than fabricate)
  - Making strategic decisions without authority (escalate to HITL)
  - Over-correcting and losing original intent (preserve core message)
  - Fixing symptoms instead of root cause (address fundamental issues)

  **When to Invoke CSO vs Business-Analyst**:
  - business-analyst: Tier 1-3 content and analysis fixes
  - cso: Only tier 4 strategic direction issues
  - Most fixes should go to business-analyst, not CSO
  - CSO time is scarce, reserve for most critical strategic decisions
